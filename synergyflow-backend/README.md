# SynergyFlow Backend - Microservices Architecture

## üìã T·ªïng Quan

SynergyFlow l√† m·ªôt n·ªÅn t·∫£ng qu·∫£n l√Ω c√¥ng vi·ªác v√† giao ti·∫øp ƒë·ªôi nh√≥m t·∫•t c·∫£-trong-m·ªôt, k·∫øt h·ª£p m√¥ h√¨nh giao ti·∫øp theo k√™nh c·ªßa Discord v·ªõi kh·∫£ nƒÉng qu·∫£n l√Ω t√°c v·ª• tr·ª±c quan c·ªßa Trello.

## üèóÔ∏è Ki·∫øn Tr√∫c H·ªá Th·ªëng

H·ªá th·ªëng ƒë∆∞·ª£c x√¢y d·ª±ng theo ki·∫øn tr√∫c **Domain-Oriented Microservice Architecture (DOMA)** v·ªõi Spring Boot v√† Gradle.

### C√°c Microservices

| Service | Port | M√¥ t·∫£ | Database |
|---------|------|-------|----------|
| **Service Discovery** | 8761 | Netflix Eureka - Service Registry | - |
| **API Gateway** | 8080 | Spring Cloud Gateway - Rate Limiting & Auth | Redis |
| **Auth Service** | 8081 | X√°c th·ª±c ng∆∞·ªùi d√πng, JWT, Google OAuth 2.0 | PostgreSQL |
| **Workspace Service** | 8082 | Qu·∫£n l√Ω Workspace, Channel, Members | PostgreSQL |
| **Task Service** | 8083 | Qu·∫£n l√Ω Task, Kanban Board, Drag-Drop | PostgreSQL |
| **Notification Service** | 8084 | Th√¥ng b√°o real-time qua WebSocket | Redis |
| **Reporting Service** | 8085 | Dashboard, Analytics, B√°o c√°o | - |

### Infrastructure Components

- **PostgreSQL 15**: C∆° s·ªü d·ªØ li·ªáu ch√≠nh cho c√°c service
- **Redis**: Cache v√† real-time notifications
- **RabbitMQ**: Message queue cho giao ti·∫øp b·∫•t ƒë·ªìng b·ªô
- **Netflix Eureka**: Service discovery
- **Spring Cloud Gateway**: API Gateway v·ªõi rate limiting

## ‚ú® T√≠nh NƒÉng Ch√≠nh

### F1: Qu·∫£n l√Ω Ng∆∞·ªùi d√πng & X√°c th·ª±c
- ‚úÖ ƒêƒÉng k√Ω/ƒêƒÉng nh·∫≠p b·∫±ng Email/Password
- ‚úÖ Google OAuth 2.0 integration
- ‚úÖ JWT Access Token & Refresh Token
- ‚úÖ Qu·∫£n l√Ω th√¥ng tin c√° nh√¢n

### F2: Qu·∫£n l√Ω Workspace & Channel
- ‚úÖ T·∫°o/Tham gia nhi·ªÅu Workspace
- ‚úÖ T·∫°o Channel trong Workspace
- ‚úÖ Qu·∫£n l√Ω th√†nh vi√™n (OWNER, ADMIN, MEMBER)
- ‚úÖ Ph√¢n quy·ªÅn theo vai tr√≤

### F3: Qu·∫£n l√Ω C√¥ng vi·ªác (Task Management)
- ‚úÖ B·∫£ng Kanban v·ªõi drag-and-drop
- ‚úÖ Task Card v·ªõi ƒë·∫ßy ƒë·ªß th√¥ng tin (ti√™u ƒë·ªÅ, m√¥ t·∫£, deadline, priority, assignee)
- ‚úÖ Di chuy·ªÉn task gi·ªØa c√°c c·ªôt
- ‚úÖ T·ª± ƒë·ªông reorder khi di chuy·ªÉn
- ‚úÖ Assign task cho nhi·ªÅu ng∆∞·ªùi

### F4: C√°c Ch·∫ø ƒë·ªô xem (Views)
- ‚úÖ Board View: Giao di·ªán Kanban
- ‚úÖ Calendar View: Hi·ªÉn th·ªã task theo ng√†y deadline

### F5: Th√¥ng b√°o Real-time
- ‚úÖ WebSocket notifications
- ‚úÖ Th√¥ng b√°o khi ƒë∆∞·ª£c assign task
- ‚úÖ Redis ƒë·ªÉ l∆∞u tr·ªØ notifications

### F6: Dashboard & B√°o c√°o
- ‚úÖ Th·ªëng k√™ ti·∫øn ƒë·ªô d·ª± √°n
- ‚úÖ Ph√¢n t√≠ch hi·ªáu su·∫•t team
- ‚úÖ Bi·ªÉu ƒë·ªì task theo tr·∫°ng th√°i, priority

## üöÄ Quick Start

### Prerequisites

- Java 17+
- Docker & Docker Compose
- Gradle 7.6+

### Ch·∫°y v·ªõi Docker Compose (Khuy·∫øn ngh·ªã)

```bash
# Clone repository
cd synergyflow-backend

# Build v√† kh·ªüi ƒë·ªông t·∫•t c·∫£ services
docker-compose up --build -d

# Xem logs
docker-compose logs -f

# D·ª´ng services
docker-compose down
```

### Ch·∫°y t·ª´ng service ri√™ng l·∫ª

```bash
# 1. Start infrastructure
docker-compose up postgres-auth postgres-workspace postgres-task redis rabbitmq -d

# 2. Build project
./gradlew build -x test

# 3. Start Service Discovery
./gradlew :service-discovery:bootRun

# 4. Start API Gateway
./gradlew :api-gateway:bootRun

# 5. Start c√°c microservices
./gradlew :auth-service:bootRun
./gradlew :workspace-service:bootRun
./gradlew :task-service:bootRun
./gradlew :notification-service:bootRun
./gradlew :reporting-service:bootRun
```

## üìñ API Documentation

### Auth Service (Port 8081)

#### ƒêƒÉng k√Ω
```bash
POST /api/auth/register
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123",
  "fullName": "Nguyen Van A"
}
```

#### ƒêƒÉng nh·∫≠p
```bash
POST /api/auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123"
}

Response:
{
  "success": true,
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiJ9...",
    "user": {
      "userId": "uuid",
      "email": "user@example.com",
      "fullName": "Nguyen Van A"
    }
  }
}
```

#### Google OAuth
```bash
POST /api/auth/oauth/google
Content-Type: application/json

{
  "googleId": "google-user-id",
  "email": "user@gmail.com",
  "fullName": "Nguyen Van A",
  "avatarUrl": "https://..."
}
```

#### Refresh Token
```bash
POST /api/auth/refresh
Content-Type: application/json

{
  "refreshToken": "eyJhbGciOiJIUzI1NiJ9..."
}
```

### Workspace Service (Port 8082)

#### T·∫°o Workspace
```bash
POST /api/workspaces
Authorization: Bearer {accessToken}

{
  "name": "My Workspace",
  "description": "Project workspace"
}
```

#### T·∫°o Channel
```bash
POST /api/workspaces/{workspaceId}/channels
Authorization: Bearer {accessToken}

{
  "name": "General",
  "description": "General discussion"
}
```

#### Th√™m Member
```bash
POST /api/workspaces/{workspaceId}/members
Authorization: Bearer {accessToken}

{
  "userId": "user-id",
  "role": "MEMBER"
}
```

### Task Service (Port 8083)

#### T·∫°o Task Board cho Channel
```bash
GET /api/tasks/boards/channel/{channelId}
Authorization: Bearer {accessToken}
```

#### T·∫°o Column trong Board
```bash
POST /api/tasks/boards/channel/{channelId}/columns
Authorization: Bearer {accessToken}

{
  "title": "To Do"
}
```

#### T·∫°o Task
```bash
POST /api/tasks/columns/{columnId}
Authorization: Bearer {accessToken}

{
  "title": "Implement login feature",
  "description": "Create login page with form validation",
  "dueDate": "2025-10-15T10:00:00",
  "priority": "HIGH",
  "assignedUserIds": ["user-id-1", "user-id-2"]
}
```

#### Di chuy·ªÉn Task (Drag & Drop)
```bash
POST /api/tasks/{taskId}/move
Authorization: Bearer {accessToken}

{
  "targetColumnId": "column-id",
  "newOrder": 2
}
```

#### L·∫•y Tasks theo Calendar View
```bash
GET /api/tasks/calendar?start=2025-10-01T00:00:00&end=2025-10-31T23:59:59
Authorization: Bearer {accessToken}
```

### Notification Service (Port 8084)

#### L·∫•y Notifications
```bash
GET /api/notifications?limit=50
Authorization: Bearer {accessToken}
```

#### WebSocket Connection
```javascript
const socket = new SockJS('http://localhost:8084/ws');
const stompClient = Stomp.over(socket);

stompClient.connect({}, function(frame) {
    stompClient.subscribe('/user/queue/notifications', function(notification) {
        console.log('New notification:', JSON.parse(notification.body));
    });
});
```

### Reporting Service (Port 8085)

#### L·∫•y th·ªëng k√™ Workspace
```bash
GET /api/reports/workspaces/{workspaceId}/statistics
Authorization: Bearer {accessToken}
```

#### L·∫•y hi·ªáu su·∫•t User
```bash
GET /api/reports/users/{userId}/performance
Authorization: Bearer {accessToken}
```

## üîí Security Features

### API Gateway
- **Rate Limiting**: Gi·ªõi h·∫°n request theo user/IP
- **JWT Authentication**: X√°c th·ª±c t·∫•t c·∫£ protected endpoints
- **Access Token & Refresh Token**: Token rotation strategy
- **CORS Protection**: C·∫•u h√¨nh cho frontend

### Auth Service
- **BCrypt Password Hashing**: 10 rounds
- **JWT v·ªõi HS256**: Signing algorithm
- **Token Expiration**:
  - Access Token: 1 hour
  - Refresh Token: 7 days
- **Google OAuth 2.0**: Social login

## üìä Database Schema

### Auth Service DB (synergyflow_auth)
```sql
users (
  user_id UUID PRIMARY KEY,
  email VARCHAR UNIQUE NOT NULL,
  password_hash VARCHAR,
  google_id VARCHAR UNIQUE,
  full_name VARCHAR,
  avatar_url VARCHAR,
  refresh_token VARCHAR,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
)
```

### Workspace Service DB (synergyflow_workspace)
```sql
workspaces (
  workspace_id UUID PRIMARY KEY,
  name VARCHAR NOT NULL,
  owner_id UUID NOT NULL,
  description TEXT,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
)

channels (
  channel_id UUID PRIMARY KEY,
  name VARCHAR NOT NULL,
  workspace_id UUID REFERENCES workspaces,
  description TEXT,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
)

workspace_members (
  id UUID PRIMARY KEY,
  workspace_id UUID REFERENCES workspaces,
  user_id UUID NOT NULL,
  role VARCHAR NOT NULL,
  joined_at TIMESTAMP,
  UNIQUE(workspace_id, user_id)
)
```

### Task Service DB (synergyflow_task)
```sql
task_boards (
  board_id UUID PRIMARY KEY,
  channel_id UUID UNIQUE NOT NULL,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
)

task_columns (
  column_id UUID PRIMARY KEY,
  title VARCHAR NOT NULL,
  board_id UUID REFERENCES task_boards,
  column_order INTEGER NOT NULL,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
)

tasks (
  task_id UUID PRIMARY KEY,
  title VARCHAR NOT NULL,
  description TEXT,
  due_date TIMESTAMP,
  priority VARCHAR NOT NULL,
  status VARCHAR NOT NULL,
  column_id UUID REFERENCES task_columns,
  creator_id UUID NOT NULL,
  task_order INTEGER NOT NULL,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
)

task_assignments (
  id UUID PRIMARY KEY,
  task_id UUID REFERENCES tasks,
  user_id UUID NOT NULL,
  assigned_at TIMESTAMP,
  UNIQUE(task_id, user_id)
)
```

## üè≠ Best Practices Implemented

### 1. **DOMA (Domain-Oriented Microservice Architecture)**
- M·ªói service ƒë·∫°i di·ªán cho m·ªôt domain nghi·ªáp v·ª•
- Autonomous v√† loosely coupled
- C√≥ database ri√™ng

### 2. **DTO & Entity Mapping**
- S·ª≠ d·ª•ng **MapStruct** cho mapping
- T√°ch bi·ªát Entity v√† DTO
- Validation v·ªõi Jakarta Bean Validation

### 3. **Repository Pattern**
- Spring Data JPA repositories
- Custom queries v·ªõi @Query
- Transaction management

### 4. **Service Layer**
- Business logic trong Service
- @Transactional cho data consistency
- Exception handling

### 5. **Controller Best Practices**
- RESTful API design
- Standard HTTP status codes
- Consistent response format (ApiResponse)

### 6. **Security**
- JWT v·ªõi Access & Refresh tokens
- Rate limiting t·∫°i API Gateway
- Role-based access control

### 7. **Async Communication**
- RabbitMQ cho events
- WebSocket cho real-time notifications

## üìÅ Project Structure

```
synergyflow-backend/
‚îú‚îÄ‚îÄ api-gateway/                 # API Gateway v·ªõi rate limiting
‚îÇ   ‚îú‚îÄ‚îÄ src/main/java/com/synergyflow/gateway/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ filter/             # JWT authentication filter
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config/             # Rate limit config
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îÇ
‚îú‚îÄ‚îÄ service-discovery/           # Netflix Eureka Server
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îÇ
‚îú‚îÄ‚îÄ auth-service/                # Authentication & User Management
‚îÇ   ‚îú‚îÄ‚îÄ src/main/java/com/synergyflow/auth/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controller/         # AuthController
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service/            # AuthService
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repository/         # UserRepository
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entity/             # User entity
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/                # Request/Response DTOs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mapper/             # MapStruct mappers
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config/             # Security config
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îÇ
‚îú‚îÄ‚îÄ workspace-service/           # Workspace & Channel Management
‚îÇ   ‚îú‚îÄ‚îÄ src/main/java/com/synergyflow/workspace/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controller/         # WorkspaceController
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service/            # WorkspaceService
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repository/         # Repositories
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entity/             # Workspace, Channel, Member
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/                # DTOs
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mapper/             # Mappers
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îÇ
‚îú‚îÄ‚îÄ task-service/                # Task & Kanban Board Management
‚îÇ   ‚îú‚îÄ‚îÄ src/main/java/com/synergyflow/task/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controller/         # TaskController
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service/            # TaskService (v·ªõi drag-drop logic)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repository/         # Repositories
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entity/             # TaskBoard, Column, Task, Assignment
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/                # DTOs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mapper/             # Mappers
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config/             # RabbitMQ config
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îÇ
‚îú‚îÄ‚îÄ notification-service/        # Real-time Notifications
‚îÇ   ‚îú‚îÄ‚îÄ src/main/java/com/synergyflow/notification/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controller/         # NotificationController
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service/            # NotificationService
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/                # DTOs
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config/             # WebSocket config
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îÇ
‚îú‚îÄ‚îÄ reporting-service/           # Analytics & Reporting
‚îÇ   ‚îú‚îÄ‚îÄ src/main/java/com/synergyflow/reporting/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controller/         # ReportingController
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service/            # ReportingService
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dto/                # Statistics DTOs
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îÇ
‚îú‚îÄ‚îÄ common-lib/                  # Shared Library
‚îÇ   ‚îî‚îÄ‚îÄ src/main/java/com/synergyflow/common/
‚îÇ       ‚îú‚îÄ‚îÄ dto/                # ApiResponse, ErrorResponse
‚îÇ       ‚îú‚îÄ‚îÄ exception/          # Custom exceptions
‚îÇ       ‚îú‚îÄ‚îÄ security/           # JwtTokenProvider
‚îÇ       ‚îî‚îÄ‚îÄ util/               # Utilities
‚îÇ
‚îú‚îÄ‚îÄ docker-compose.yml           # Docker orchestration
‚îú‚îÄ‚îÄ build.gradle                 # Root Gradle config
‚îú‚îÄ‚îÄ settings.gradle              # Multi-project setup
‚îî‚îÄ‚îÄ README.md
```

## üåê Environment Variables

```bash
# JWT Configuration
JWT_SECRET=your-secret-key-min-256-bits
JWT_ACCESS_EXPIRATION=3600000
JWT_REFRESH_EXPIRATION=604800000

# Database Configuration
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=postgres

# Redis Configuration
REDIS_HOST=localhost
REDIS_PORT=6379

# RabbitMQ Configuration
RABBITMQ_HOST=localhost
RABBITMQ_PORT=5672
RABBITMQ_USER=guest
RABBITMQ_PASSWORD=guest
```

## üß™ Testing

```bash
# Run all tests
./gradlew test

# Run tests for specific service
./gradlew :auth-service:test
./gradlew :workspace-service:test
./gradlew :task-service:test
```

## üì¶ Build & Deploy

```bash
# Build all services
./gradlew build

# Build specific service
./gradlew :auth-service:build

# Build Docker images
docker-compose build

# Deploy to production
docker-compose -f docker-compose.prod.yml up -d
```

## üéØ Service URLs

- **Eureka Dashboard**: http://localhost:8761
- **API Gateway**: http://localhost:8080
- **RabbitMQ Management**: http://localhost:15672 (guest/guest)
- **Auth Service**: http://localhost:8081
- **Workspace Service**: http://localhost:8082
- **Task Service**: http://localhost:8083
- **Notification Service**: http://localhost:8084
- **Reporting Service**: http://localhost:8085

## üë• Contributors

- Le Quoc Khanh - [@lequockhanh19521680](https://github.com/lequockhanh19521680)

## üìù License

This project is licensed under the MIT License.

---

**Made with ‚ù§Ô∏è for SynergyFlow Team**
